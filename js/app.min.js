var model=[{name:"Sombrero Beach",lat:24.691533,"long":-81.086107,cat:["beaches","parks"],imgUrl:"",address:"Sombrero Beach Rd., Marathon",placeid:"001",website:"http://www.ci.marathon.fl.us/government/parks/city-parks-and-beaches/",phoneNumber:"(305) 743-0033"},{name:"Coco Plum Beach",lat:24.73024,"long":-81.001592,cat:["beaches","parks"],imgUrl:"",address:"Coco Plum Dr., Marathon",placeid:"002",website:"http://www.ci.marathon.fl.us/government/parks/city-parks-and-beaches/",phoneNumber:"(305) 743-0033"}],map=new google.maps.Map(document.getElementById("map-canvas"),{zoom:12,center:{lat:24.723009,lng:-81.038884}}),markers=[],marker,request,service=new google.maps.places.PlacesService(map),infowindow=new google.maps.InfoWindow,infoWindowIsOpen=!1;view={init:function(){var e=["hospitality","culture","recreation","government","services"],o=["&#9789;","&#9774;","&#9786;","&#10026;","&#36;"],a=["Hospitality ","Culture ","Recreation ","Government ","Services "];for(i=0;i<e.length;i++)$("#map-canvas").width()>570?($("#"+e[i]).replaceWith('<a href="#" id='+e[i]+">"+a[i]+"&#9660;</a>"),$("#"+e[i]).css("text-align","left")):($("#"+e[i]).replaceWith('<a href="#" id='+e[i]+">"+o[i]+"</a>"),$("#"+e[i]).css("text-align","center"),$("#"+e[i]).css("line-height","30px"))},getLocations:function(e){function o(e,o){if(o==google.maps.places.PlacesServiceStatus.OK)for(var i=0;i<e.length;i++){{e[i]}a(e[i])}}function a(e){var o=e.name,a=e.geometry.location.lat(),n=e.geometry.location.lng(),l=e.vicinity,t=i.types,s="",r=e.place_id;e.hasOwnProperty("photos")&&(s=e.photos[0].getUrl({maxWidth:100,maxHeight:100})),locations.push(new Location(o,a,n,t,l,s,r));var c={name:o,lat:a,"long":n,cat:t,address:l,imgUrl:s,placeid:r};model.push(c)}var i={location:map.center,radius:"20000",types:[e]};service.nearbySearch(i,o)},addMarkers:function(e,o,a,i,n,l,t){marker=new google.maps.Marker({position:new google.maps.LatLng(o,a),name:e,map:map,cat:i,address:n,imgUrl:l,placeid:t}),google.maps.event.addListener(marker,"click",function(){return function(){view.sortClickedMarkers(t)}}(marker)),markers.push(marker)},getPlaceDetails:function(e){function o(o,n){if(n==google.maps.places.PlacesServiceStatus.OK){{o.name}a=o.formatted_phone_number,i=o.website,e=o.place_id,openInfoWindow(a,e,i)}}var a="",i="",n={placeId:e()};service.getDetails(n,o)},sortClickedMarkers:function(e){if(ko.utils.unwrapObservable(e).length>6)view.getClickedPlaceDetails(e);else for(var o in model)if(model[o].placeid===ko.utils.unwrapObservable(e)){var a=model[o].phoneNumber,i=model[o].website;openInfoWindow(a,ko.utils.unwrapObservable(e),i)}},getClickedPlaceDetails:function(e){function o(o,n){if(n==google.maps.places.PlacesServiceStatus.OK){a=o.formatted_phone_number,i=o.website;{o.name}e=o.place_id,openInfoWindow(a,e,i)}}var a="",i="",n={placeId:e};service.getDetails(n,o)}};var viewModel=function(){var e=this;this.locations=ko.observableArray([]),this.query=ko.observable(""),this.Location=function(e,o,a,i,n,l,t){this.name=ko.observable(e),this.lat=o,this["long"]=a,this.cat=ko.observable(i),this.imgUrl=ko.observable(l),this.placeid=ko.observable(t),view.addMarkers(e,o,a,i,n,l,t)},this.emptyLocations=function(){e.recenterMap();for(var o=0;o<markers.length;o++)markers[o].setMap(null);markers.length=0,e.locations.removeAll()},this.getPlaces=function(e){for(var o in model)for(i=0;i<model[o].cat.length;i++)model[o].cat[i]===e&&locations.push(new Location(model[o].name,model[o].lat,model[o]["long"],model[o].cat,model[o].address,model[o].imgUrl,model[o].placeid))},this.sortPlaces=function(e){if(ko.utils.unwrapObservable(e).length>6)view.getPlaceDetails(e);else for(var o in model)if(model[o].placeid===ko.utils.unwrapObservable(e)){var a=model[o].phoneNumber,i=model[o].website;openInfoWindow(a,ko.utils.unwrapObservable(e),i)}},this.recenterMap=function(){map.setCenter(new google.maps.LatLng(24.723009,-81.038884)),map.setOptions({zoom:12}),e.closeInfoWindow()},this.searchBox=function(){var o=this.query().toLowerCase();for(place in model)model[place].name.toLowerCase()===o&&(e.emptyLocations(),locations.push(new Location(model[place].name,model[place].lat,model[place]["long"],model[place].cat,model[place].address,model[place].imgUrl,model[place].placeid)));e.closeInfoWindow(),this.recenterMap()},this.closeInfoWindow=function(){infoWindowIsOpen===!0&&infowindow.close(),infoWindowIsOpen=!1},this.openInfoWindow=function(e,o,a){for(place in model)if(model[place].placeid===o){{var i=model[place].lat,n=model[place]["long"],l=model[place].name,t=model[place].address;model[place].placeid}if($("#map-canvas").height()>=350)var s=model[place].imgUrl;else s="";if(void 0===e)var r="";else r=e;if(void 0===a)var c="";else c=a}if(""===s)if(""===c)var p='<p class="bold">'+l+"</p><p>"+t+"<br/>"+r+"</p>";else p='<p class="bold">'+l+"</p><p>"+t+"<br/>"+r+'<br/><a href="'+c+'">Website</a></p>';else p=""===c?'<p class="bold">'+l+'</p><img src="'+s+'""><p>'+t+"<br/>"+r+"</p>":'<p class="bold">'+l+'</p><img src="'+s+'""><p>'+t+"<br/>"+r+'<br/><a href="'+c+'">Website</a></p>';infowindow.setPosition({lat:i,lng:n}),infowindow.setOptions({pixelOffset:new google.maps.Size(0,-35)}),infowindow.setContent(p),infowindow.open(map),infoWindowIsOpen=!0,map.setOptions({zoom:15,center:{lat:i,lng:n}}),$("html, body").animate({scrollTop:0},"fast")}};view.init(),ko.applyBindings(viewModel()),$(window).resize(function(){view.init()});
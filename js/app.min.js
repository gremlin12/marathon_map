var model=[{name:"Sombrero Beach",lat:24.691533,"long":-81.086107,cat:["beaches","park"],imgUrl:"",address:"Sombrero Beach Rd., Marathon",placeid:"001",website:"http://www.ci.marathon.fl.us/government/parks/city-parks-and-beaches/",phoneNumber:"(305) 743-0033"},{name:"Coco Plum Beach",lat:24.73024,"long":-81.001592,cat:["beaches","park"],imgUrl:"",address:"Coco Plum Dr., Marathon",placeid:"002",website:"http://www.ci.marathon.fl.us/government/parks/city-parks-and-beaches/",phoneNumber:"(305) 743-0033"},{name:"Jesse Hobbs Park",lat:24.713604,"long":-81.087036,cat:["park"],imgUrl:"",address:"41st St. and Overseas Hwy, Marathon",placeid:"003",website:"http://www.ci.marathon.fl.us/government/parks/city-parks-and-beaches/",phoneNumber:"(305) 743-0033"},{name : 'Building Department',lat : 24.711935,long : -81.09753899999998,cat : ['local_government_office'],imgUrl : '',address : '2798 Overseas Hwy., Suite 330',placeid : '004',website : 'http://www.monroecounty-fl.gov/Directory.aspx?did=6',phoneNumber : '(305) 289-2501'}],map=new google.maps.Map(document.getElementById("map-canvas"),{zoom:12,center:mapCenter}),mapCenter=new google.maps.LatLng(24.723009,-81.038884),markers=[],marker,request,service=new google.maps.places.PlacesService(map),infowindow=new google.maps.InfoWindow,infoWindowIsOpen=!1,badID=["ChIJVfjV4b_e0IgRC_zIFw2KZNY","ChIJdeEhcr_e0IgRwYuxONiDjJg","ChIJ40NtAb_e0IgRXF3FSvPYdPU","ChIJR2JaoIDZ0IgRVYFo3Et9jGY","ChIJh72I2H_Z0IgRc_2GCzQ4ojA","ChIJ0x-jPCra0IgRPj4_dJeO8Jc","ChIJyX_gNmPZ0IgR8Vq2WN5q3m4","ChIJV2D-j07Z0IgRnFu34GH4Jfg","ChIJifxZz0zZ0IgR_KJsoTes2fU","ChIJOW7ImUTZ0IgRwK52f_32ivU","ChIJQbj4sOre0IgRIa8HNNSYAbA","ChIJ8ZtRVZXe0IgRc7VP0JUYXTk","ChIJlytLLbHe0IgRnsMbhZIyrto","ChIJl3iw0bne0IgRiepETBQaOxQ"],availableTags=[];view={init:function(){var a=["hospitality","culture","recreation","government","services"],b=["&#9789;","&#9774;","&#9786;","&#10026;","&#36;"],c=["Hospitality ","Culture ","Recreation ","Government ","Services "];for(i=0;i<a.length;i++)$("#map-canvas").width()>570?($("#"+a[i]).replaceWith('<a href="#" id='+a[i]+">"+c[i]+"&#9660;</a>"),$("#"+a[i]).css("text-align","left")):($("#"+a[i]).replaceWith('<a href="#" id='+a[i]+">"+b[i]+"</a>"),$("#"+a[i]).css("text-align","center"),$("#"+a[i]).css("line-height","30px"))},getLocations:function(a){function c(a,b){if(b==google.maps.places.PlacesServiceStatus.OK)for(var c=0;c<a.length;c++){{a[c]}d(a[c])}}function d(a){var c=a.name,d=a.geometry.location.lat(),e=a.geometry.location.lng(),f=a.vicinity,g=b.types,h="",i=a.place_id;if(a.hasOwnProperty("photos")&&(h=a.photos[0].getUrl({maxWidth:100,maxHeight:100})),-1===jQuery.inArray(i,badID)){locations.push(new Location(c,d,e,g,f,h,i));var j={name:c,lat:d,"long":e,cat:g,address:f,imgUrl:h,placeid:i};model.push(j),autoComplete()}}var b={location:map.center,radius:"20000",types:[a]};service.nearbySearch(b,c)},addMarkers:function(a,b,c,d,e,f,g){marker=new google.maps.Marker({position:new google.maps.LatLng(b,c),name:a,map:map,cat:d,address:e,imgUrl:f,placeid:g}),google.maps.event.addListener(marker,"click",function(){return function(){view.sortClickedMarkers(g)}}(marker)),markers.push(marker)},getPlaceDetails:function(a){function e(d,e){if(e==google.maps.places.PlacesServiceStatus.OK){{d.name}b=d.formatted_phone_number,c=d.website,a=d.place_id,openInfoWindow(b,a,c)}}var b="",c="",d={placeId:a()};service.getDetails(d,e)},sortClickedMarkers:function(a){if(ko.utils.unwrapObservable(a).length>6)view.getClickedPlaceDetails(a);else for(var b in model)if(model[b].placeid===ko.utils.unwrapObservable(a)){var c=model[b].phoneNumber,d=model[b].website;openInfoWindow(c,ko.utils.unwrapObservable(a),d)}},getClickedPlaceDetails:function(a){function e(d,e){if(e==google.maps.places.PlacesServiceStatus.OK){b=d.formatted_phone_number,c=d.website;{d.name}a=d.place_id,openInfoWindow(b,a,c)}}var b="",c="",d={placeId:a};service.getDetails(d,e)}};var viewModel=function(){var a=this;this.locations=ko.observableArray([]),this.query=ko.observable(""),this.Location=function(a,b,c,d,e,f,g){this.name=ko.observable(a),this.lat=b,this.long=c,this.cat=ko.observable(d),this.imgUrl=ko.observable(f),this.placeid=ko.observable(g),view.addMarkers(a,b,c,d,e,f,g)},this.emptyLocations=function(){a.recenterMap();for(var b=0;b<markers.length;b++)markers[b].setMap(null);markers.length=0,a.locations.removeAll()},this.getPlaces=function(b){for(var c in model)for(i=0;i<model[c].cat.length;i++)model[c].cat[i]===b&&(locations.push(new Location(model[c].name,model[c].lat,model[c].long,model[c].cat,model[c].address,model[c].imgUrl,model[c].placeid)),a.autoComplete)},this.sortPlaces=function(a){if(ko.utils.unwrapObservable(a).length>6)view.getPlaceDetails(a);else for(var b in model)if(model[b].placeid===ko.utils.unwrapObservable(a)){var c=model[b].phoneNumber,d=model[b].website;openInfoWindow(c,ko.utils.unwrapObservable(a),d)}},this.recenterMap=function(){map.setCenter(mapCenter),map.setOptions({zoom:12}),a.closeInfoWindow()},this.searchBox=function(){var c=this.query().toLowerCase();for(place in model)model[place].name.toLowerCase()===c&&(a.emptyLocations(),locations.push(new Location(model[place].name,model[place].lat,model[place].long,model[place].cat,model[place].address,model[place].imgUrl,model[place].placeid)));a.closeInfoWindow(),this.recenterMap()},this.clearSearchBox=function(){$("#autocomplete").val("")},this.autoComplete=function(){for(place in model)-1===jQuery.inArray(model[place].name,availableTags)&&availableTags.push(model[place].name)},this.closeInfoWindow=function(){infoWindowIsOpen===!0&&infowindow.close(),infoWindowIsOpen=!1},this.openInfoWindow=function(a,b,c){for(place in model)if(model[place].placeid===b){{var d=model[place].lat,e=model[place].long,f=model[place].name,g=model[place].address;model[place].placeid}if($("#map-canvas").height()>=350)var i=model[place].imgUrl;else i="";if(void 0===a)var j="";else j=a;if(void 0===c)var k="";else k=c}if(""===i)if(""===k)var l='<p class="bold">'+f+"</p><p>"+g+"<br/>"+j+"</p>";else l='<p class="bold">'+f+"</p><p>"+g+"<br/>"+j+'<br/><a href="'+k+'">Website</a></p>';else l=""===k?'<p class="bold">'+f+'</p><img src="'+i+'""><p>'+g+"<br/>"+j+"</p>":'<p class="bold">'+f+'</p><img src="'+i+'""><p>'+g+"<br/>"+j+'<br/><a href="'+k+'">Website</a></p>';infowindow.setPosition({lat:d,lng:e}),infowindow.setOptions({pixelOffset:new google.maps.Size(0,-35)}),infowindow.setContent(l),infowindow.open(map),infoWindowIsOpen=!0,map.setOptions({zoom:15,center:{lat:d,lng:e}}),$("html, body").animate({scrollTop:0},"fast")}};view.init(),ko.applyBindings(viewModel()),$(window).resize(function(){view.init()}),$("#autocomplete").autocomplete({source:availableTags});